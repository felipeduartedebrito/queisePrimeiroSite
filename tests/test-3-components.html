<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Teste 3 - Components</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 0;
            padding: 0;
            background: #f8f9fa;
        }
        .header {
            background: #4682B4;
            color: white;
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        #cart-container {
            position: relative;
        }
        .container {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 2rem;
        }
        #products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 2rem;
            margin: 2rem 0;
        }
        .controls {
            background: white;
            padding: 1.5rem;
            border-radius: 12px;
            margin-bottom: 2rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        button {
            padding: 0.75rem 1.5rem;
            margin: 0.5rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.95rem;
            transition: transform 0.2s;
        }
        button:hover { transform: scale(1.05); }
        .btn-primary { background: #4682B4; color: white; }
        .btn-success { background: #28a745; color: white; }
        .btn-danger { background: #dc3545; color: white; }
    </style>
</head>
<body>
    <div class="header">
        <h1>üß© Teste 3: Components Completo</h1>
        <div id="cart-container"></div>
    </div>

    <div class="container">
        <div class="controls">
            <h3>üõí Controles do Carrinho:</h3>
            <button class="btn-success" onclick="addRandomProduct()">
                ‚ûï Adicionar Produto Aleat√≥rio
            </button>
            <button class="btn-danger" onclick="clearCart()">
                üóëÔ∏è Limpar Carrinho
            </button>
            <button class="btn-primary" onclick="showCartInfo()">
                ‚ÑπÔ∏è Info do Carrinho
            </button>
        </div>

        <h2>üì¶ Produtos Dispon√≠veis</h2>
        <div id="products-grid"></div>

        <div class="controls">
            <h3>‚úÖ Checklist de Testes:</h3>
            <ul>
                <li>Bot√£o do carrinho aparece no header?</li>
                <li>Contador do carrinho funciona?</li>
                <li>Cards de produtos aparecem?</li>
                <li>Bot√£o "Adicionar ao Carrinho" funciona?</li>
                <li>Notifica√ß√£o aparece ao adicionar?</li>
                <li>Contador atualiza automaticamente?</li>
                <li>Badges (desconto, novo) aparecem?</li>
                <li>Limpar carrinho zera o contador?</li>
            </ul>
        </div>
    </div>

    <script type="module">
        import { Notification } from '../assets/js/components/Notification.js';
        import { ProductCard } from '../assets/js/components/ProductCard.js';
        import { CartButton } from '../assets/js/components/CartButton.js';
        import { api } from '../assets/js/core/api.js';
        import { CartStorage } from '../assets/js/core/storage.js';

        // Inicializar bot√£o do carrinho
        const cartBtn = new CartButton('#cart-container', {
            showCount: true,
            showTotal: false,
            icon: 'üõí'
        });

        // Carregar produtos
        async function loadProducts() {
            try {
                const { products } = await api.getProducts({ first: 6 });
                const container = document.getElementById('products-grid');
                
                ProductCard.renderMany(products, container, {
                    layout: 'grid',
                    showQuickAdd: true
                });

                Notification.success(`${products.length} produtos carregados!`);
            } catch (error) {
                Notification.error('Erro ao carregar produtos');
                console.error(error);
            }
        }

        // Adicionar produto aleat√≥rio
        window.addRandomProduct = async () => {
            try {
                const { products } = await api.getProducts({ first: 10 });
                const randomProduct = products[Math.floor(Math.random() * products.length)];
                
                CartStorage.addItem({
                    id: `${randomProduct.id}-${Date.now()}`,
                    name: randomProduct.title,
                    basePrice: randomProduct.price,
                    quantity: 1,
                    image: randomProduct.images?.[0]?.url
                });

                window.dispatchEvent(new CustomEvent('cartUpdated'));
                Notification.success(`${randomProduct.title} adicionado!`);
            } catch (error) {
                Notification.error('Erro ao adicionar produto');
            }
        };

        // Limpar carrinho
        window.clearCart = () => {
            CartStorage.clear();
            window.dispatchEvent(new CustomEvent('cartUpdated'));
            Notification.info('Carrinho limpo!');
        };

        // Mostrar info do carrinho
        window.showCartInfo = () => {
            const count = CartStorage.getCount();
            const total = CartStorage.getTotal();
            const formatted = (total / 100).toLocaleString('pt-BR', {
                style: 'currency',
                currency: 'BRL'
            });
            
            Notification.info(`üìä Carrinho: ${count} itens | Total: ${formatted}`);
        };

        // Carregar produtos ao iniciar
        loadProducts();

        console.log('‚úÖ Todos os components carregados!');
    </script>
</body>
</html>
